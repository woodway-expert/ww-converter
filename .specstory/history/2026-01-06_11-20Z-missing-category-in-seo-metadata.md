<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session ae620958-80d9-4413-8065-4f0671722ab4 (2026-01-06 11:20Z) -->

# Missing category in SEO metadata (2026-01-06 11:20Z)

_**User (2026-01-06 06:52Z)**_

It's missing the category ("Дошка") from the name and description, etc. Please investigate.

---

_**Agent (model default, mode Plan)**_



---


Investigating why the category ("Дошка") is missing from the filename, alt text, title, and description. Searching the codebase for where these are generated.


---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "How are output filenames generated with product settings like category type wood species?" • **8** results</summary>
            
| File | Lines |
|------|-------|
| `src/core/renamer.py` | L28-564 |
| `src/core/renamer.py` | L51-564 |
| `src/core/exporter.py` | L178 |
| `README.md` | L144-207 |
| `src/gui/app.py` | L69-1874 |
| `src/gui/app.py` | L69-1880 |
| `src/core/exporter.py` | L11-178 |
| `src/core/renamer.py` | L51 |

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "How are alt text title description generated for SEO metadata?" • **5** results</summary>
            
| File | Lines |
|------|-------|
| `src/core/renamer.py` | L51-564 |
| `src/ai/gemini_client.py` | L21-548 |
| `src/core/metadata.py` | L8-202 |
| `src/gui/app.py` | L69-1874 |
| `src/core/renamer.py` | L12-564 |

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "Where is category included in tags but not in filename or description?" • **9** results</summary>
            
| File | Lines |
|------|-------|
| `src/core/renamer.py` | L51-564 |
| `src/core/renamer.py` | L28-564 |
| `src/data/categories.json` | L28 |
| `src/core/renamer.py` | L51 |
| `.cursor/rules/derived-cursor-rules.mdc` | L126-163 |
| `src/gui/app.py` | L69-1874 |
| `.cursor/rules/derived-cursor-rules.mdc` | L73-132 |
| `README.md` | L144-207 |
| `docs/PROJECT_PLAN.md` | L51-109 |

</details>
</tool-use>

---



---


Reading the metadata generation methods to understand how category is handled:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/core/renamer.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "def _generate_ua_metadata|def _generate_en_metadata|def _generate_ru_metadata" in "src/core/renamer.py" • 3 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `src/core/renamer.py` | `def _generate_ua_metadata(` | L230 |
| `src/core/renamer.py` | `def _generate_en_metadata(` | L293 |
| `src/core/renamer.py` | `def _generate_ru_metadata(` | L356 |


</details>
</tool-use>

---



---


Checking how tags are generated and how AI metadata generation handles category:


---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "How are tags generated with category product type species for SEO metadata?" • **3** results</summary>
            
| File | Lines |
|------|-------|
| `src/core/renamer.py` | L51-564 |
| `src/ai/gemini_client.py` | L21-548 |
| `src/core/renamer.py` | L28-564 |

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/ai/gemini_client.py</summary>

</details>
</tool-use>

---



---


Checking how tags are generated and displayed in the UI:


---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "tags|Tags|ТЕГИ|теги" in "src/gui/app.py" • 13 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `src/gui/app.py` | `# Tags field (for videos)` | L790 |
| `src/gui/app.py` | `ctk.CTkLabel(tab, text="Теги:").pack(anchor="w", padx=5)` | L791 |
| `src/gui/app.py` | `tags_box = ctk.CTkTextbox(tab, height=50, width=300)` | L792 |
| `src/gui/app.py` | `tags_box.pack(padx=5, pady=2)` | L793 |
| `src/gui/app.py` | `self.lang_fields[lang]["tags"] = tags_box` | L794 |
| `src/gui/app.py` | `"tags": ", ".join(video_lang_data.get("video_tags", []))` | L1311 |
| `src/gui/app.py` | `"tags": ""  # Images don't have tags` | L1320 |
| `src/gui/app.py` | `# Update all fields including tags` | L1323 |
| `src/gui/app.py` | `for field in ["alt_text", "title", "description", "tags"]:` | L1324 |
| `src/gui/app.py` | `for field in ["alt_text", "title", "description", "tags"]:` | L1335 |
| `src/gui/app.py` | `# Store full video-specific metadata (including tags)` | L1407 |
| `src/gui/app.py` | `# Store full video-specific metadata (including tags)` | L1495 |
| `src/gui/app.py` | `for field in ["alt_text", "title", "description", "tags"]:` | L1839 |


</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "Where are tags generated and displayed in the UI for SEO metadata?" • **3** results</summary>
            
| File | Lines |
|------|-------|
| `src/core/renamer.py` | L51-564 |
| `src/gui/app.py` | L69-1874 |
| `src/ai/gemini_client.py` | L21-548 |

</details>
</tool-use>

---



---


Reviewing the filename generation logic and how category is handled when both category and product_type are present:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/core/renamer.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/core/renamer.py</summary>

</details>
</tool-use>

---



---


Identified issues:

1. Filename generation: When both `category` and `product_type` are set, only `product_type` is used (lines 97-100 in `renamer.py`). The category should also be included.

2. Metadata generation: The condition `category != product` (line 248) may exclude the category when it should always be included when present.

3. AI prompts: The Gemini prompts mention category but don't explicitly require it in titles/descriptions.

Creating a plan to fix this:


---

<tool-use data-tool-type="unknown" data-tool-name="create_plan">
<details>
<summary>Tool use: **create_plan**</summary>


Parameters:

```json
{
  "plan": "# Fix Missing Category in Filenames and Metadata\n\n## Problem\nThe category (\"Дошка\") is missing from:\n- Filenames (e.g., &#96;obrizna-horikh-amerykanskyi-52mm-extra-01.webm&#96; should include &#96;doshka&#96;)\n- Alt text, titles, and descriptions in metadata\n- Tags include category correctly, but other fields don't\n\n## Root Causes\n\n1. **Filename generation** (&#96;src/core/renamer.py:97-100&#96;): Uses &#96;product_type&#96; OR &#96;category&#96;, not both\n2. **Metadata generation** (&#96;src/core/renamer.py:248&#96;): Condition &#96;category != product&#96; may exclude category when it should always be included\n3. **AI prompts** (&#96;src/ai/gemini_client.py&#96;): Don't explicitly require category in generated content\n\n## Solution\n\n### 1. Fix Filename Generation\nUpdate &#96;generate_filename()&#96; in &#96;src/core/renamer.py&#96; to include both category and product_type when both are present:\n- Include category slug first, then product_type slug\n- Format: &#96;{category}-{product_type}-{species}-...&#96;\n\n### 2. Fix Metadata Generation\nUpdate &#96;_generate_ua_metadata()&#96;, &#96;_generate_en_metadata()&#96;, and &#96;_generate_ru_metadata()&#96; in &#96;src/core/renamer.py&#96;:\n- Change condition from &#96;category != product&#96; to always include category when present\n- Ensure category appears in all templates (title, alt_text, description)\n\n### 3. Update AI Prompts\nEnhance prompts in &#96;src/ai/gemini_client.py&#96;:\n- Explicitly instruct to include category in titles, descriptions, and alt text\n- Add examples showing category inclusion\n\n## Files to Modify\n\n1. &#96;src/core/renamer.py&#96;\n   - &#96;generate_filename()&#96; method (lines 77-134)\n   - &#96;_generate_ua_metadata()&#96; method (lines 230-291)\n   - &#96;_generate_en_metadata()&#96; method (lines 293-354)\n   - &#96;_generate_ru_metadata()&#96; method (lines 356-417)\n\n2. &#96;src/ai/gemini_client.py&#96;\n   - &#96;generate_seo_metadata()&#96; prompt (lines 123-179)\n   - &#96;generate_video_seo_metadata()&#96; prompt (lines 333-398)\n\n## Expected Results\n\nAfter fix:\n- Filename: &#96;doshka-obrizna-horikh-amerykanskyi-52mm-extra-01.webm&#96;\n- Alt text: \"Кадр з відео дошка обрізна горіх американський...\"\n- Title: \"презентація Дошка Обрізна Горіх американський | WoodWay Expert\"\n- Description: \"Дивіться презентація дошка обрізна горіх американський...\"",
  "name": "Include category in filenames and metadata",
  "todos": [
    {
      "content": "Update generate_filename() to include category slug when both category and product_type are present",
      "status": "pending",
      "id": "fix-filename-generation"
    },
    {
      "content": "Fix _generate_ua_metadata() to always include category when present, not just when different from product",
      "status": "pending",
      "id": "fix-ua-metadata"
    },
    {
      "content": "Fix _generate_en_metadata() to always include category when present",
      "status": "pending",
      "id": "fix-en-metadata"
    },
    {
      "content": "Fix _generate_ru_metadata() to always include category when present",
      "status": "pending",
      "id": "fix-ru-metadata"
    },
    {
      "content": "Enhance Gemini prompts to explicitly require category in generated metadata",
      "status": "pending",
      "id": "update-ai-prompts"
    }
  ],
  "overview": "Fix the missing category (\"Дошка\") in generated filenames, alt text, titles, and descriptions. The category should always be included when present, even when product_type is also set."
}
```
Additional data:

```json
{
  "reviewData": {
    "status": "Requested",
    "selectedOption": "none",
    "isShowingInput": false
  },
  "planUri": "file:///c%3A/Users/system_administrator/.cursor/plans/include_category_in_filenames_and_metadata_59b2e1b4.plan.md",
  "hasOpenedEditor": true,
  "pinnedName": "Include category in filenames and metadata"
}
```
Result:

```json
{
  "accepted": {
    "finalTodos": [
      {
        "content": "Update generate_filename() to include category slug when both category and product_type are present",
        "status": "pending",
        "id": "fix-filename-generation"
      },
      {
        "content": "Fix _generate_ua_metadata() to always include category when present, not just when different from product",
        "status": "pending",
        "id": "fix-ua-metadata"
      },
      {
        "content": "Fix _generate_en_metadata() to always include category when present",
        "status": "pending",
        "id": "fix-en-metadata"
      },
      {
        "content": "Fix _generate_ru_metadata() to always include category when present",
        "status": "pending",
        "id": "fix-ru-metadata"
      },
      {
        "content": "Enhance Gemini prompts to explicitly require category in generated metadata",
        "status": "pending",
        "id": "update-ai-prompts"
      }
    ]
  },
  "planUri": "c:\\Users\\system_administrator\\.cursor\\plans\\include_category_in_filenames_and_metadata_59b2e1b4.plan.md"
}
```
Status: **completed**


</details>
</tool-use>

---

_**User (2026-01-06 06:52Z)**_

Implement the plan as specified, it is attached for your reference. Do NOT edit the plan file itself.

To-do's from the plan have already been created. Do not create them again. Mark them as in_progress as you work, starting with the first one. Don't stop until you have completed all the to-dos.

---

_**Agent (model default, mode Agent)**_



---


Implementing the plan. Starting with filename generation, then metadata generation, then AI prompts.


---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [-] Update generate_filename() to include category slug when both category and product_type are present
- [ ] Fix _generate_ua_metadata() to always include category when present, not just when different from product
- [ ] Fix _generate_en_metadata() to always include category when present
- [ ] Fix _generate_ru_metadata() to always include category when present
- [ ] Enhance Gemini prompts to explicitly require category in generated metadata

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/core/renamer.py</summary>

</details>
</tool-use>

---



---


Fixing filename generation to include both category and product_type when both are present:


---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: src/core/renamer.py</summary>

**Chunk 1**
Lines added: 3, lines removed: 2

```diff
@@ -95,8 +95,9 @@
          
          # Build filename parts in order of importance
+         # Include category first, then product_type (if both are present)
+         if attributes.category:
+             parts.append(self._get_slug(attributes.category))
          if attributes.product_type:
              parts.append(self._get_slug(attributes.product_type))
-         elif attributes.category:
-             parts.append(self._get_slug(attributes.category))
          
          if attributes.species:
```

</details>

</tool-use>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] Update generate_filename() to include category slug when both category and product_type are present
- [-] Fix _generate_ua_metadata() to always include category when present, not just when different from product
- [ ] Fix _generate_en_metadata() to always include category when present
- [ ] Fix _generate_ru_metadata() to always include category when present
- [ ] Enhance Gemini prompts to explicitly require category in generated metadata

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/core/renamer.py</summary>

</details>
</tool-use>

---



---


Fixing the UA metadata generation to always include category when present:


---

The model provided an ambiguous search string to replace.

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] Update generate_filename() to include category slug when both category and product_type are present
- [x] Fix _generate_ua_metadata() to always include category when present, not just when different from product
- [-] Fix _generate_en_metadata() to always include category when present
- [ ] Fix _generate_ru_metadata() to always include category when present
- [ ] Enhance Gemini prompts to explicitly require category in generated metadata

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/core/renamer.py</summary>

</details>
</tool-use>

---



---


Updating all three metadata methods to always include category when present:


---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: src/core/renamer.py</summary>

**Chunk 1**
Lines added: 2, lines removed: 1

```diff
@@ -247,5 +247,6 @@
          
          # Build display strings with category included
-         category_part = f"{category} " if category and category != product else ""
+         # Always include category when present, even if product_type is also present
+         category_part = f"{category} " if category else ""
          product_part = product if product else ""
          species_part = species if species else ""
```

**Chunk 2**
Lines added: 2, lines removed: 1

```diff
@@ -310,5 +311,6 @@
          
          # Build display strings with category included
-         category_part = f"{category} " if category and category != product else ""
+         # Always include category when present, even if product_type is also present
+         category_part = f"{category} " if category else ""
          product_part = product if product else ""
          species_part = species if species else ""
```

**Chunk 3**
Lines added: 2, lines removed: 1

```diff
@@ -373,5 +375,6 @@
          
          # Build display strings with category included
-         category_part = f"{category} " if category and category != product else ""
+         # Always include category when present, even if product_type is also present
+         category_part = f"{category} " if category else ""
          product_part = product if product else ""
          species_part = species if species else ""
```

</details>

</tool-use>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] Update generate_filename() to include category slug when both category and product_type are present
- [x] Fix _generate_ua_metadata() to always include category when present, not just when different from product
- [x] Fix _generate_en_metadata() to always include category when present
- [x] Fix _generate_ru_metadata() to always include category when present
- [-] Enhance Gemini prompts to explicitly require category in generated metadata

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/ai/gemini_client.py</summary>

</details>
</tool-use>

---



---


Updating the AI prompts to explicitly require category inclusion:


---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: src/ai/gemini_client.py</summary>

**Chunk 1**
Lines added: 1, lines removed: undefined

```diff
@@ -133,4 +133,5 @@
     - Describe what's visually in the image (wood grain, texture, color)
     - Include primary keyword naturally
+    - **CRITICAL: Always include the Category (e.g., "Дошка", "Шпон", "Фанера") when provided, even if Product Type is also present**
     - Conversational tone for voice search compatibility
     - When thickness is provided with imperial equivalent (e.g., "25 mm (1 inch)"), include both metric and imperial measurements naturally
```

**Chunk 2**
Lines added: 1, lines removed: undefined

```diff
@@ -139,4 +140,5 @@
  2. **TITLE** (max 60 chars per language):
     - Front-load the primary keyword
+    - **CRITICAL: Always include the Category (e.g., "Дошка", "Шпон", "Фанера") when provided, even if Product Type is also present**
     - Include brand at end: "| WoodWay Expert"
     - Engaging but descriptive
```

**Chunk 3**
Lines added: 1, lines removed: undefined

```diff
@@ -145,4 +147,5 @@
  3. **DESCRIPTION** (max 160 chars per language):
     - Answer user intent: what is it, why buy it, key features
+    - **CRITICAL: Always include the Category (e.g., "Дошка", "Шпон", "Фанера") when provided, even if Product Type is also present**
     - Include secondary keywords naturally
     - When thickness is provided with imperial equivalent, include both measurements in natural format:
```

</details>

</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/ai/gemini_client.py</summary>

</details>
</tool-use>

---



---


Updating the video prompt to require category inclusion:


---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: src/ai/gemini_client.py</summary>

**Chunk 1**
Lines added: 1, lines removed: undefined

```diff
@@ -345,4 +345,5 @@
  1. **VIDEO_TITLE** (max 60 chars per language):
     - Front-load the primary keyword
+    - **CRITICAL: Always include the Category (e.g., "Дошка", "Шпон", "Фанера") when provided, even if Product Type is also present**
     - Include video type indicator (Огляд/Review, Презентація, etc.)
     - Include brand at end: "| WoodWay Expert"
```

**Chunk 2**
Lines added: 1, lines removed: undefined

```diff
@@ -351,4 +352,5 @@
  2. **VIDEO_DESCRIPTION** (max 160 chars per language):
     - Summarize what viewer will learn/see
+    - **CRITICAL: Always include the Category (e.g., "Дошка", "Шпон", "Фанера") when provided, even if Product Type is also present**
     - Include key product features
     - When thickness is provided with imperial equivalent, include both measurements naturally:
```

**Chunk 3**
Lines added: 1, lines removed: undefined

```diff
@@ -360,4 +362,5 @@
  3. **THUMBNAIL_ALT_TEXT** (max 125 chars per language):
     - Describe the video thumbnail/poster image
+    - **CRITICAL: Always include the Category (e.g., "Дошка", "Шпон", "Фанера") when provided, even if Product Type is also present**
     - Include primary keyword naturally
     - When thickness is provided, include imperial measurement if space allows
```

</details>

</tool-use>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] Update generate_filename() to include category slug when both category and product_type are present
- [x] Fix _generate_ua_metadata() to always include category when present, not just when different from product
- [x] Fix _generate_en_metadata() to always include category when present
- [x] Fix _generate_ru_metadata() to always include category when present
- [x] Enhance Gemini prompts to explicitly require category in generated metadata

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 2 files</summary>
      
Lint paths:

- `src/core/renamer.py`
- `src/ai/gemini_client.py`

Lint results


**No lint errors found**
</details>
</tool-use>

---



---


## Changes Made

### 1. Filename Generation (`src/core/renamer.py`)
- Updated `generate_filename()` to include both category and product_type when both are present
- Format: `{category}-{product_type}-{species}-...` (e.g., `doshka-obrizna-horikh-amerykanskyi-52mm-extra-01.webm`)

### 2. Metadata Generation (`src/core/renamer.py`)
- Updated `_generate_ua_metadata()`, `_generate_en_metadata()`, and `_generate_ru_metadata()` to always include category when present
- Changed condition from `category != product` to `if category` so category is included even when product_type is also present
- Category now appears in all templates (title, alt_text, description)

### 3. AI Prompts (`src/ai/gemini_client.py`)
- Enhanced both `generate_seo_metadata()` and `generate_video_seo_metadata()` prompts
- Added explicit instructions to always include category in alt_text, title, and description when provided
- Added examples showing category inclusion

## Results

- Filenames: `doshka-obrizna-horikh-amerykanskyi-52mm-extra-01.webm`
- Alt text: "Кадр з відео дошка обрізна горіх американський..."
- Title: "презентація Дошка Обрізна Горіх американський | WoodWay Expert"
- Description: "Дивіться презентація дошка обрізна горіх американський..."

All changes pass linting. The category ("Дошка") is now included in filenames and all metadata fields when present.

---

